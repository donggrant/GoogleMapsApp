<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Converter</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4">Google Maps Converter</h2>
        <div class="form-group">
            <label for="conversionType">Conversion Type:</label>
            <select class="form-control" id="conversionType">
                <option value="addressToLatLng">Address to Lat-Lng</option>
                <option value="latLngToAddress">Lat-Lng to Address</option>
                <option value="getBoundingBox">Get Bounding Box</option>
            </select>
        </div>
        <div class="form-group">
            <label for="input">Input:</label>
            <input type="text" class="form-control" id="input" placeholder="Enter address or lat-lng...">
        </div>
        <button class="btn btn-primary" onclick="convert()">Convert</button>
        <div class="mt-4" id="result"></div>
    </div>

    <div id="error-message" class="alert alert-danger mt-4" role="alert" style="display: none; width: 50%; margin-left: 25%;"></div>

    <script>

        function displayResult(resultText) {
            $("#result").html(resultText);
        }

        function displayErrorMessage(errorMessage) {
            $("#error-message").text(errorMessage).show();
        }

        function convert() {
            $("#error-message").hide();
            let action = $("#conversionType").val();
            let input = $("#input").val().trim();
            let payload = { "action": action };

            if (!input) {
                displayErrorMessage("Please provide input.");
            }

            if (action === "addressToLatLng") {
                payload["input"] = input;
            } else if (action == "latLngToAddress") {
                if (!input.includes(',')) {
                    $("#error-message").text("Please provide a valid Lat-Lng pair separated by a comma.").show();
                    return;
                }
                let [lat, lng] = input.split(",");
                payload["lat"] = parseFloat(lat.trim());
                payload["lng"] = parseFloat(lng.trim());
            } else if (action == "getBoundingBox") {
                payload["city"] = input
            }

            if (action === "getBoundingBox") {
                $.ajax({
                    url: "/bounding_box",
                    type: "POST",
                    data: JSON.stringify({ "city": input }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        displayResult(
                            `Bounding Box: Northeast Lat = ${data.NORTHEAST_LAT}, 
                            Northeast Lng = ${data.NORTHEAST_LNG}, 
                            Southwest Lat = ${data.SOUTHWEST_LAT}, 
                            Southwest Lng = ${data.SOUTHWEST_LNG}`
                        );
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        let errorMessage = "An error occurred: ";
                        if (jqXHR.responseJSON && jqXHR.responseJSON.error) {
                            errorMessage += jqXHR.responseJSON.error;
                        } else {
                            errorMessage += textStatus;
                        }
                        displayErrorMessage(errorMessage);
                    }
                });
            } else {
                $.ajax({
                url: "/convert",
                type: "POST",
                data: JSON.stringify(payload),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data) {
                    if (action === "addressToLatLng") {
                        displayResult("Coordinates: Latitude = " + data.lat + ", Longitude = " + data.lng);
                    } else if (action == "latLngToAddress") {
                        displayResult("Address: " + data.address);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    let errorMessage = "An error occurred: ";
                    if (jqXHR.responseJSON && jqXHR.responseJSON.error) {
                        errorMessage += jqXHR.responseJSON.error;
                    } else {
                        errorMessage += textStatus;
                    }
                    displayErrorMessage(errorMessage);
                }
                });
            }

        }
    </script>
</body>

</html>
